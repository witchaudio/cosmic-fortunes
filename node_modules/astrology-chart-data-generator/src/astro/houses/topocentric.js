import {
  degreesToRadians,
  normaliseDegree,
  radiansToDegrees,
} from "../../utils/math";
import { calculateAscensionDegree, convertToZodiacString } from "../utils";

export const calculateTopocentricHouses = ({
  ascendant,
  descendant,
  midheaven,
  lowerMidheaven,
  latitude,
  obliquity,
  siderealTimeAngle,
}) => {
  var A = radiansToDegrees(
    Math.atan((1 / 3) * Math.tan(degreesToRadians(latitude)))
  );
  var B = radiansToDegrees(
    Math.atan((2 / 3) * Math.tan(degreesToRadians(latitude)))
  );

  const cusps = [];
  const zDeg = obliquity;
  cusps.push(ascendant);
  cusps.push(
    calculateAscensionDegree({
      xDeg: siderealTimeAngle + 30,
      yDeg: B,
      zDeg,
    })
  );
  cusps.push(
    calculateAscensionDegree({
      xDeg: siderealTimeAngle + 60,
      yDeg: A,
      zDeg,
    })
  );
  cusps.push(lowerMidheaven);
  cusps.push(
    calculateAscensionDegree({
      xDeg: siderealTimeAngle - 60,
      yDeg: A,
      zDeg,
    }) + 180
  );
  cusps.push(
    calculateAscensionDegree({
      xDeg: siderealTimeAngle - 30,
      yDeg: B,
      zDeg,
    }) + 180
  );
  cusps.push(descendant);
  cusps.push(cusps[1] + 180);
  cusps.push(cusps[2] + 180);
  cusps.push(midheaven);
  cusps.push(cusps[4] + 180);
  cusps.push(cusps[5] + 180);
  return cusps.map((cusp) => ({
    degree: normaliseDegree(cusp),
    zodiacDegree: convertToZodiacString(cusp),
  }));
};
